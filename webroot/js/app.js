function pad(a){return 10>a?"0"+a:a}function showMessage(a,b){$("#mh-messages").append($("<div/>").attr("data-alert",!0).addClass("mh-flash "+b).text(a).hide().slideToggle("slow").delay(3e3).slideToggle("slow"))}var MHCounter=0;$.fn.toggleClick=function(){var a=arguments,b=0;return this.click(function(){a[b].apply(this,arguments),b=(b+1)%a.length})},$.fn.scrollToMe=function(a,b){var c=this;return setTimeout(function(){var d=c.offset().top-10;$("html,body").eq(0).animate({scrollTop:d},a||500,b)},500),this},$(document).ready(function(){$(document).foundation(),$(document).trigger("mh-refresh")}),$(document).ajaxComplete(function(a,b,c){$(document).foundation(),$(document).trigger("mh-refresh")}),$(document).off("mh-refresh").on("mh-refresh",function(){function a(a,b,c){if(theUpdate=a._element.id,"inline"==a._options.mhMode){var d=a._options.mhRefresh+"/"+b;$("#"+a._options.mhField).val(c)}else var d=a._options.mhRefresh;e(a,d,theUpdate,!1)}function b(a){theField=a._options.mhField,theFile=f($("#"+theField).val()),theUpdate=a._element.id,theRefresh=a._options.mhRefresh+"/"+theFile,e(a,theRefresh,theUpdate,!0)}function c(a){$("#"+a).find(".qq-upload-preview-list").hide("slide",{direction:"left"},1e3)}function d(a){$("#"+a).find(".qq-upload-preview-list").show("slide",{direction:"up"},1e3)}function e(a,b,c,e){theBusy=jsVars.assets+"ajax-loader.gif",$("#"+c).find(".qq-upload-preview-list").fadeIn(),$("#"+c).find(".qq-upload-preview-list").html('<img scr="'+theBusy+'" />'),$.ajax({url:b,global:!1,async:e,data:{"class":a._options.mhClass,fk:a._options.mhFk,field:a._options.mhModelField},success:function(a){$("#"+c).find(".qq-upload-preview-list").hide(),$("#"+c).find(".qq-upload-preview-list").html(a),d(c)}})}function f(a){return a.split("/").reverse()[0]}$(".mh-autocomplete").autocomplete({minLength:3,source:function(a,b){var c="#"+this.element[0].id,d=$(c).attr("mh-url");$.ajax({dataType:"json",global:!1,url:d,data:{term:a.term},success:function(a){b($.map(a,function(a){return{label:a.label,value:a.value}}))},error:function(a,b,c){alert(b),alert(c)}})},focus:function(a,b){var c="#"+a.target.id,d="#"+$(c).attr("mh-target");return $(c).val(b.item.label),$(d).val(b.item.value),!1},select:function(a,b){var c="#"+a.target.id,d="#"+$(c).attr("mh-target");return $(c).val(b.item.label),$(d).val(b.item.value),!1}}),$(".mh-ajax-button").off("click").on("click",function(a){var b=$(this).attr("mh-indicator"),c=$(this).attr("mh-update");return $(b).fadeIn(),$.ajax({url:$(this).attr("href"),cache:!1,success:function(a){$(c).html(a)},complete:function(a){$(b).fadeOut()}}),!1}),$(".mh-ajax-btn-update").off("click").on("click",function(a){return $.ajax({dataType:"html",evalScripts:!0,url:$(this).attr("href"),beforeSend:function(b){$($(a.target).attr("mh-indicator")).fadeIn()},success:function(b,c){$($(a.target).attr("mh-update")).html(b)},complete:function(b,c){$($(a.target).attr("mh-indicator")).fadeOut()}}),!1}),$(".mh-check-all").toggleClick(function(){var a=$(this).attr("mh-target");$("[id^="+a+"]").prop("checked",!0),$(this).val($(this).attr("mh-message-uncheck"))},function(){var a=$(this).attr("mh-target");$("[id^="+a+"]").prop("checked",!1),$(this).val($(this).attr("mh-message-check"))}),$(".mh-clearfield").click(function(a){var b=$(this).attr("mh-target");$(b).val("");var c=b+"-alt";void 0!=c&&$(c).val("")});var g=new Date;pad(g.getDate())+"-"+pad(g.getMonth()+1)+"-"+g.getFullYear();if($(".mh-date").datepicker({dateFormat:"dd-mm-yy",showOtherMonths:!0,selectOtherMonths:!0,changeMonth:!0,changeYear:!0,showButtonPanel:!0,showOn:"focus",altField:"alt",altFormat:"yy-mm-dd"}),$(".mh-date").datepicker($.datepicker.regional.es),$(".mh-date").each(function(){$(this).datepicker("option","altField",$(this).attr("mh-altfield")),$(this).datepicker("option","altFormat","yy-mm-dd")}),$.fn.multiDatesPicker&&($(".mh-multidate").multiDatesPicker({dateFormat:"dd-mm-yy",showOtherMonths:!0,selectOtherMonths:!0,changeMonth:!0,changeYear:!0,showButtonPanel:!0,showOn:"focus",altField:"#alt",altFormat:"yy-mm-dd"}),$(".mh-multidate").multiDatesPicker($.datepicker.regional.es),$("#ui-datepicker-div").css("clip","auto"),$(".mh-multidate").each(function(){$(this).datepicker("option","altField",$(this).attr("mh-altfield")),$(this).datepicker("option","altFormat","yy-mm-dd")}),$(".mh-date-range").multiDatesPicker({dateFormat:"dd-mm-yy",showOtherMonths:!0,selectOtherMonths:!0,changeMonth:!0,changeYear:!0,showButtonPanel:!0,showOn:"focus",altField:"#alt",altFormat:"yy-mm-dd",maxPicks:2}),$(".mh-date-range").multiDatesPicker($.datepicker.regional.es),$(".mh-date-range").each(function(){$(this).datepicker("option","altField",$(this).attr("mh-altfield")),$(this).datepicker("option","altFormat","yy-mm-dd")})),$(".mh-bind").off("click").on("click",function(a){$("#mh-permissions-busy-indicator").fadeIn();var b=$(this).attr("mh-update");return $.ajax({data:{owm:$(this).attr("mh-owner-model"),owid:$($(this).attr("mh-owner-id")).val(),obm:$(this).attr("mh-object-model"),obid:$(this).attr("mh-object-id"),access:$($(this).attr("mh-access")).val(),cburl:$(this).attr("mh-url")},url:owVars.Url.bind,success:function(a){$(b).html(a)},complete:function(a){$("#mh-permissions-busy-indicator").fadeOut()}}),!1}),$(".mh-unbind").off("click").on("click",function(a){$("#mh-permissions-busy-indicator").fadeIn();var b=$(this).attr("mh-update");return $.ajax({data:{owm:$(this).attr("mh-owner-model"),owid:$(this).attr("mh-owner-id"),obm:$(this).attr("mh-object-model"),obid:$(this).attr("mh-object-id"),cburl:$(this).attr("mh-url")},url:owVars.Url.unbind,success:function(a){$(b).html(a)},complete:function(a){$("#mh-permissions-busy-indicator").fadeOut()}}),!1}),$(".mh-rebind").off("change").on("change",function(a){$("#mh-permissions-busy-indicator").fadeIn();var b=$(this).attr("mh-update");return $.ajax({data:{owm:$(this).attr("mh-owner-model"),owid:$(this).attr("mh-owner-id"),obm:$(this).attr("mh-object-model"),obid:$(this).attr("mh-object-id"),access:$(this).val(),cburl:$(this).attr("mh-url")},url:owVars.Url.rebind,success:function(a){$(b).html(a)},complete:function(a){$("#mh-permissions-busy-indicator").fadeOut()}}),!1}),$(".mh-disclose").toggleClick(function(){event.preventDefault();var a=$(this).attr("mh-target");$(a).show();var b=$(this).attr("mh-readonly-field");$("input[id^="+b+"]").prop("readonly",!0)},function(){event.preventDefault();var a=$(this).attr("mh-target");$(a).hide();var b=$(this).attr("mh-readonly-field");$("input[id^="+b+"]").prop("readonly",!1)}),$(".mh-show-by-value").on("change",function(a){var b=$(this).val(),c=$(this).attr("mh-show-on-empty"),d=$(this).attr("mh-show-on-value");0==b?($(d).hide(),$(c).show()):($(c).hide(),$(d).show())}),$(window).on("load",function(a){$(".mh-show-by-value").trigger("change")}),$(".mh-translate").click(function(a){a.stopPropagation(),a.preventDefault();var b="#"+$(this).attr("sfield"),c="#"+$(this).attr("tfield");$(c+"-busy").fadeIn(),$.get(jsVars.translate,{text:$(b).val(),sl:$(this).attr("sl"),tl:$(this).attr("tl")},function(a,b,d){$(c).val(a),$(c+"-busy").fadeOut()})}),setTimeout(function(){$(".mh-flash").fadeOut("slow",function(){$(this).remove()})},6e3),$(".mh-flash").fadeIn("slow"),"undefined"!=typeof qq){$(".uploader").on("click",".mh-uploader-cleaner",function(a){$("#"+$(this).attr("mh_target")).val(""),$(this).parent().parent().find(".qq-upload-preview-list").html("")});var h=new Array;$(".uploader").each(function(d){var e=new qq.FileUploader({debug:!1,element:$(this)[0],action:$(this).attr("mh-upload"),multiple:"1"==$(this).attr("mh-multiple")?!0:!1,allowedExtensions:jsVars.extensions[$(this).attr("mh-extensions")],sizeLimit:0,mhMode:$(this).attr("mh-mode"),mhRefresh:$(this).attr("mh-refresh"),mhDiv:$(this).attr("id"),mhClass:$(this).attr("mh-class"),mhFk:$(this).attr("mh-fk"),mhModelField:$(this).attr("mh-field"),mhField:$(this).attr("mh-target"),mhCompleteUrl:$(this).attr("mh-complete-url"),mhCompleteUpdate:$(this).attr("mh-complete-update"),uploadButtonText:"Haz clic para seleccionar archivos.",dragText:"Arrastra archivos aqu√≠.",hideShowDropArea:!0,template:'<div class="qq-uploader"><div class="qq-upload-manage small-3 columns"><div class="qq-upload-drop-area"><span>{dragText}</span></div><div class="qq-upload-button">{uploadButtonText}</div></div><div class="qq-upload-preview-list"></div><div class="qq-upload-progress-info small-9 columns"><ul class="qq-upload-list"></ul></div></div>',fileTemplate:'<li><span class="qq-progress-bar"></span><span class="qq-upload-file"></span><span class="qq-upload-spinner"></span><span class="qq-upload-size"></span><a class="qq-upload-cancel" href="#">{cancelButtonText}</a><span class="qq-upload-failed-text">{failUploadtext}</span></li>',params:{"class":$(this).attr("mh-class"),plugin:$(this).attr("mh-plugin"),field:$(this).attr("mh-field"),fk:$(this).attr("mh-fk"),limit:$(this).attr("mh-limit"),extensions:jsVars.extensions[$(this).attr("mh-extensions")].toString()},onComplete:function(b,c,d){"inline"==e._options.mhMode&&a(e,d.file,d.path),void 0!=e._options.mhCompleteUrl&&$.get(e._options.mhCompleteUrl,function(a,b,c){$(e._options.mhCompleteUpdate).html(a)});var f=e._getItemByFileId(b);$(f).fadeOut(1600,"linear")},onProgress:function(a,b,d,f){var g=e._getItemByFileId(a),h=e._find(g,"size");c(e._element.id),h.style.display="inline";var i,j=Math.round(d/f*100);i=d!=f?j+"% de "+e._formatSize(f):e._formatSize(f),e._find(g,"progressBar").style.width=j+"%",qq.setText(h,i)}});if("inline"==e._options.mhMode){var f=$("<button/>",{text:"Borrar",id:"Clear-"+e._options.mhField,type:"button",mh_target:e._options.mhField,"class":"mh-uploader-cleaner mh-webkit-reset mh-button mh-button-delete mh-btn-uploader-clear",click:"return false;"});$(this).find(".qq-upload-manage").append(f),b(e)}else c(e._element.id);h.push(e)})}$(".mh-ajax-add").off("click").on("click",function(a){return $.ajax({async:!0,dataType:"html",evalScripts:!0,url:$(this).attr("mh-url"),beforeSend:function(b){$($(a.target).attr("mh-indicator")).fadeIn()},success:function(b,c){$($(a.target).attr("mh-update")).html(b)},complete:function(b,c){$($(a.target).attr("mh-update")).foundation("reveal","open"),$($(a.target).attr("mh-indicator")).fadeOut()}}),!1}),$(".mh-ajax-send").off("click").on("click",function(a){return $.ajax({data:$(this).closest("form").serialize(),dataType:"html",evalScripts:!0,type:"post",url:$(this).attr("mh-url"),beforeSend:function(b){$($(a.target).attr("mh-close")).foundation("reveal","close"),$($(a.target).attr("mh-indicator")).fadeIn()},success:function(b,c){$($(a.target).attr("mh-update")).html(b)},complete:function(b,c){$($(a.target).attr("mh-indicator")).fadeOut()}}),!1}),$(".mh-ajax-btn-reveal").off("click").on("click",function(a){return $.ajax({dataType:"html",evalScripts:!0,url:$(this).attr("href"),beforeSend:function(b){$($(a.target).attr("mh-indicator")).fadeIn()},success:function(b,c){$($(a.target).attr("mh-update")).html(b)},complete:function(b,c){$($(a.target).attr("mh-update")).foundation("reveal","open"),$($(a.target).attr("mh-indicator")).fadeOut()}}),!1}),$(document).off("close.fndtn.reveal").on("close.fndtn.reveal","[data-reveal]",function(){var a=($(this),$(this).attr("mh-url"));return void 0==a?!1:($.getJSON(a,function(a){return $.each(a,function(a,b){$("#"+a).val(b)}),console.log("Form updated"),!1}),!1)}),$(".mh-parent-select").on("change",function(a){return $.ajax({async:!0,global:!1,data:{key:$(this).val()},dataType:"html",url:$(this).attr("mh-url"),beforeSend:function(b,c){$($(a.target).attr("mh-indicator")).fadeIn()},success:function(b,c){$($(a.target).attr("mh-update")).html(b)},complete:function(b,c){$($(a.target).attr("mh-indicator")).fadeOut()}}),!1}),$(".mh-image-rotate").off("click").on("click",function(a){a.preventDefault(),a.stopPropagation();var b={};return b.file=$(a.target).attr("mh-file"),b.angle=$(a.target).attr("mh-angle"),b.size=$(a.target).attr("mh-size"),$.ajax({async:!0,dataType:"html",url:$(this).attr("href"),data:b,global:!1,beforeSend:function(b){$($(a.target).attr("mh-indicator")).fadeIn()},success:function(b,c){$($(a.target).attr("mh-update")).html(b)},complete:function(b,c){$($(a.target).attr("mh-indicator")).fadeOut(),showMessage("Image rotated","mh-success")}}),!1})});